<!DOCTYPE html>
<html lang="bs">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Event Timer – Clean</title>
<style>
  :root{
    --bg:#ffffff;
    --digit1:#ff8ec0; --digit2:#ff5a9b;  /* Elegant gradijent */
    --digit-color:#111111;               /* 7seg/Flip */
    --digit-size: clamp(88px, 20vw, 320px);
    --digit-stretch: 1.22;
    --sep-gap: clamp(12px, 4vw, 40px);
    --font: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    --panel-bg:#0b1220f5;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:var(--font); color:#000; background:var(--bg);
    display:flex; flex-direction:column; align-items:center; justify-content:center;
    overflow:hidden;
  }

  /* gornja traka */
  .top{display:flex; flex-direction:column; align-items:center; gap:.4rem; text-align:center; padding:1rem .8rem 0}
  .logo{height: clamp(44px, 9vh, 110px); object-fit:contain}
  .title{margin:0; letter-spacing:.04em; font-weight:700; opacity:.92; font-size: clamp(16px, 2.3vw, 30px); color:#111}

  /* timer */
  .timer{display:flex; align-items:end; justify-content:center; gap:var(--sep-gap); line-height:1; user-select:none; padding:.6rem 1rem 1rem}
  .sep{width:.6em; text-align:center; font-weight:900; font-size: calc(var(--digit-size) * 0.9)}
  .blink{animation:blink 1s steps(1,end) infinite}
  @keyframes blink{50%{opacity:.2}}

  /* -- ELEGANT -- */
  .theme-elegant .digit, .theme-elegant .sep{
    font-variant-numeric: tabular-nums; font-weight:950; font-size:var(--digit-size);
    letter-spacing:.02em; transform:scaleY(var(--digit-stretch)); transform-origin:center bottom;
    text-shadow: 0 1px 0 rgba(0,0,0,.5), 0 10px 24px rgba(0,0,0,.16);
  }
  .theme-elegant .digit{
    background: linear-gradient(180deg, var(--digit1), var(--digit2));
    -webkit-background-clip:text; background-clip:text; color:transparent;
  }
  .theme-elegant .sep{ color:#cc2b6f }

  /* -- 7SEG -- */
  .theme-7seg .digit, .theme-7seg .sep{
    font-family:"DSDIGI","Digital-7",monospace; font-weight:900; font-size:var(--digit-size);
    letter-spacing:.04em; transform:scaleY(1.05); color:var(--digit-color);
    text-shadow:none;
  }

  /* -- FLIP -- */
  .theme-flip .digit-wrap{ perspective:1000px; width:.65em; height:1.1em; position:relative; display:inline-block }
  .theme-flip .card{position:absolute; inset:0; display:flex; align-items:center; justify-content:center; font-variant-numeric:tabular-nums; font-weight:900; font-size:var(--digit-size); color:var(--digit-color)}
  .theme-flip .flip{animation:flip .6s ease-in-out; transform-origin:center top}
  @keyframes flip{0%{transform:rotateX(0)}100%{transform:rotateX(-180deg)}}

  /* toggle dugme (auto-hide u FS) */
  .toggle{
    position:fixed; left:50%; transform:translateX(-50%);
    bottom: max(16px, env(safe-area-inset-bottom)); z-index:30;
    border:none; cursor:pointer; padding:.7rem 1.1rem; border-radius:999px;
    background:#0f172acc; color:#fff; font-weight:800;
    transition:opacity .25s ease, transform .25s ease; opacity:1;
  }
  .toggle.hidden{opacity:0; pointer-events:none; transform:translate(-50%,8px)}

  /* PANEL – potpuno sakriven dok je zatvoren */
  .panel{
    position:fixed; left:0; right:0; bottom:0; z-index:26;
    background:var(--panel-bg); color:#fff; backdrop-filter:blur(10px);
    border-top:1px solid rgba(255,255,255,.08);
    box-shadow:0 -24px 60px rgba(0,0,0,.4);
    transform: translateY(100%); /* SKRIVENO */
    transition: transform .35s ease;
    height: min(56vh, 520px);
    padding-bottom: max(12px, env(safe-area-inset-bottom));
  }
  .panel.open{ transform: translateY(0) }
  .panel .content{height:100%; overflow:auto; padding:16px}

  .grid{ display:grid; gap:12px; grid-template-columns: repeat(6, minmax(0,1fr)) }
  .grid > div{ display:flex; flex-direction:column; gap:6px }
  label{ font-size:.86rem; opacity:.85 }
  input, select{ width:100%; padding:.55rem .65rem; border-radius:10px; border:1px solid rgba(255,255,255,.12); background:#111827; color:#fff }
  .row{ grid-column:1 / -1; display:flex; gap:10px; flex-wrap:wrap }
  .row button{ padding:.7rem 1rem; border-radius:12px; border:1px solid rgba(255,255,255,.12); background:#1f2937; color:#fff; font-weight:800; cursor:pointer }
  .row button:hover{ background:#243041 }
  .note{ opacity:.75; font-size:.85rem }
  .pill{ display:inline-flex; gap:.4rem; flex-wrap:wrap }
  .pill button{ border-radius:999px; padding:.4rem .8rem }
  .right{ margin-left:auto }

  .blackout{position:fixed; inset:0; background:#000; z-index:40; display:none}
  .blackout.show{display:block}

  @media (max-width:820px){ .grid{grid-template-columns:repeat(2,minmax(0,1fr))} .sep{width:.45em} }
</style>
</head>
<body>

  <div class="top" id="topBar">
    <img class="logo" src="logo.png" alt="Logo" onerror="this.style.display='none'"/>
    <h1 class="title" id="titleText">WORKSHOP COUNTDOWN</h1>
  </div>

  <div class="timer theme-elegant" id="timerBox" aria-live="polite">
    <span class="digit" id="m1">1</span>
    <span class="digit" id="m2">0</span>
    <span class="sep" id="sep">:</span>
    <span class="digit" id="s1">0</span>
    <span class="digit" id="s2">0</span>
  </div>

  <button class="toggle hidden" id="toggleBtn" aria-expanded="false">▴ Kontrole</button>

  <!-- PANEL -->
  <div class="panel" id="panel" aria-hidden="true">
    <div class="content">
      <div class="grid">
        <div class="row">
          <div style="flex:1">
            <label>Naslov (iznad timera)</label>
            <input id="inTitle" type="text" placeholder="npr. SPORTS & EVENTS WORKSHOP"/>
          </div>
          <div>
            <label>Prikaži gornju traku</label>
            <select id="inTop"><option value="on" selected>On</option><option value="off">Off</option></select>
          </div>
          <div class="pill right">
            <button data-preset="10">10:00</button>
            <button data-preset="5">05:00</button>
            <button data-preset="2">02:00</button>
            <button data-preset="1">01:00</button>
          </div>
        </div>

        <div><label>Minute</label><input id="inMin" type="number" min="0" value="10"/></div>
        <div><label>Sekunde</label><input id="inSec" type="number" min="0" max="59" value="0"/></div>
        <div><label>Stil timera</label>
          <select id="inTheme">
            <option value="elegant" selected>Elegant</option>
            <option value="7seg">Seven-Seg</option>
            <option value="flip">Flip (listanje)</option>
          </select>
        </div>
        <div><label>Veličina cifara (px, 0=auto)</label><input id="inSize" type="number" min="0" max="500" value="0"/></div>
        <div><label>Elongacija (Elegant)</label><input id="inStretch" type="range" min="1.0" max="1.6" step="0.01" value="1.22"/></div>
        <div><label>Separator</label><input id="inSep" type="text" maxlength="2" value=":"/></div>

        <div><label>Pozadina</label><input id="inBg" type="text" value="#ffffff"/></div>
        <div><label>Boja gore (Elegant)</label><input id="inCol1" type="text" value="#ff8ec0"/></div>
        <div><label>Boja dolje (Elegant)</label><input id="inCol2" type="text" value="#ff5a9b"/></div>
        <div><label>Boja cifara (7seg/Flip)</label><input id="inDigitColor" type="text" value="#111111"/></div>
        <div><label>Blink separator</label><select id="inBlink"><option value="on" selected>On</option><option value="off">Off</option></select></div>
        <div><label>Auto-hide controls u fullscreen-u</label><select id="inAutoHide"><option value="on" selected>On</option><option value="off">Off</option></select></div>

        <div><label>Zvuk – 5 min</label><input id="inBeep5" type="text" placeholder="beep5.mp3"/></div>
        <div><label>Zvuk – 1 min</label><input id="inBeep1" type="text" placeholder="beep1.mp3"/></div>
        <div><label>Zvuk – kraj</label><input id="inEnd" type="text" placeholder="alarm.mp3"/></div>
        <div><label>Glasnoća</label><input id="inVol" type="range" min="0" max="1" step="0.01" value="1"/></div>

        <div class="row">
          <button id="btnApply">Primijeni</button>
          <button id="btnStart">▶ Start</button>
          <button id="btnPause">⏸ Pauza</button>
          <button id="btnReset">⟲ Reset</button>
          <button id="btnFS">⤢ Fullscreen</button>
          <button id="btnBlack">⬛ Blackout</button>
          <span class="note">Prečice: <b>Space/Enter/→/PgDn</b> start/pauza · <b>←/PgUp/R</b> reset · <b>F</b> fullscreen · <b>B</b> blackout · <b>H</b> panel</span>
        </div>

        <div class="row">
          <button id="btnTest5">Test 5:00</button>
          <button id="btnTest1">Test 1:00</button>
          <button id="btnTestEnd">Test kraj</button>
          <span class="note">Postavke se čuvaju lokalno (localStorage).</span>
        </div>
      </div>
    </div>
  </div>

  <div class="blackout" id="blackout"></div>

<script>
/* ====== kratki helperi ====== */
const $=id=>document.getElementById(id);
const timerBox=$('timerBox'), sepEl=$('sep'), topBar=$('topBar');
const m1=$('m1'), m2=$('m2'), s1=$('s1'), s2=$('s2');
const panel=$('panel'), toggleBtn=$('toggleBtn'), blackout=$('blackout');
const inTitle=$('inTitle'), titleText=$('titleText'), inTop=$('inTop');
const inMin=$('inMin'), inSec=$('inSec'), inTheme=$('inTheme'), inSize=$('inSize'), inStretch=$('inStretch');
const inSep=$('inSep'), inBg=$('inBg'), inCol1=$('inCol1'), inCol2=$('inCol2'), inDigitColor=$('inDigitColor');
const inBlink=$('inBlink'), inAutoHide=$('inAutoHide');
const inBeep5=$('inBeep5'), inBeep1=$('inBeep1'), inEnd=$('inEnd'), inVol=$('inVol');
const btnApply=$('btnApply'), btnStart=$('btnStart'), btnPause=$('btnPause'), btnReset=$('btnReset'), btnFS=$('btnFS'), btnBlack=$('btnBlack');
const btnTest5=$('btnTest5'), btnTest1=$('btnTest1'), btnTestEnd=$('btnTestEnd');

/* ====== stanje ====== */
let durationMs=(10*60)*1000, endAt=null, running=false, raf=null;
let alerted5=false, alerted1=false, ended=false;
let snd5=null, snd1=null, sndEnd=null;

/* ====== audio ====== */
function mkAudio(p){ if(!p) return null; const a=new Audio(p); a.preload='auto'; a.volume=parseFloat(inVol.value||1); return a; }
function loadAudio(){ snd5=mkAudio(inBeep5.value.trim()); snd1=mkAudio(inBeep1.value.trim()); sndEnd=mkAudio(inEnd.value.trim()); }
inVol.addEventListener('input', ()=>[snd5,snd1,sndEnd].forEach(a=>{ if(a) a.volume=parseFloat(inVol.value||1); }));

/* ====== prikaz ====== */
function setDigits(mm, ss){
  const [a,b]=String(mm).padStart(2,'0'); const [c,d]=String(ss).padStart(2,'0');
  if(!timerBox.classList.contains('theme-flip')){ m1.textContent=a; m2.textContent=b; s1.textContent=c; s2.textContent=d; return; }
  applyFlip(m1,a); applyFlip(m2,b); applyFlip(s1,c); applyFlip(s2,d);
}
function paint(ms){ if(ms<0) ms=0; const t=Math.floor(ms/1000); setDigits(Math.floor(t/60), t%60); }
function applyFlip(el,next){ if(el.textContent===next) return; el.innerHTML=''; const wrap=document.createElement('span'); wrap.className='digit-wrap'; const card=document.createElement('span'); card.className='card flip'; card.textContent=next; wrap.appendChild(card); el.appendChild(wrap); }

/* ====== logika ====== */
function start(){ if(running) return; endAt=performance.now()+durationMs; running=true; loop(); }
function pause(){ if(!running) return; running=false; cancelAnimationFrame(raf); durationMs=Math.max(0, endAt-performance.now()); }
function reset(){ running=false; cancelAnimationFrame(raf); alerted5=alerted1=ended=false; durationMs=(+inMin.value*60 + +inSec.value)*1000; paint(durationMs); }
function loop(){
  if(!running) return;
  let left=endAt-performance.now(); if(left<0) left=0;
  const secLeft=Math.ceil(left/1000);
  if(!alerted5 && secLeft===300){ alerted5=true; snd5&&snd5.play().catch(()=>{}); }
  if(!alerted1 && secLeft===60){ alerted1=true; snd1&&snd1.play().catch(()=>{}); }
  paint(left);
  if(left===0){ if(!ended){ ended=true; running=false; sndEnd&&sndEnd.play().catch(()=>{}); } return; }
  raf=requestAnimationFrame(loop);
}

/* ====== tema / primjena ====== */
function applyTheme(){
  timerBox.classList.remove('theme-elegant','theme-7seg','theme-flip');
  timerBox.classList.add('theme-'+inTheme.value);
  document.documentElement.style.setProperty('--digit-size', (+inSize.value>0? inSize.value+'px':'clamp(88px, 20vw, 320px)'));
  document.documentElement.style.setProperty('--digit-stretch', inStretch.value);
  document.documentElement.style.setProperty('--bg', inBg.value||'#ffffff');
  document.documentElement.style.setProperty('--digit1', inCol1.value||'#ff8ec0');
  document.documentElement.style.setProperty('--digit2', inCol2.value||'#ff5a9b');
  document.documentElement.style.setProperty('--digit-color', inDigitColor.value||'#111111');
  const s=(inSep.value||':').slice(0,2); sepEl.textContent=s; sepEl.classList.toggle('blink', inBlink.value==='on');
  topBar.style.display = (inTop.value==='off') ? 'none' : 'flex';
  if(inTheme.value==='flip'){ setDigits(parseInt(m1.textContent+m2.textContent,10), parseInt(s1.textContent+s2.textContent,10)); }
}

/* ====== panel & toggle ====== */
function togglePanel(forceOpen){
  const open = forceOpen!==undefined ? !!forceOpen : !panel.classList.contains('open');
  panel.classList.toggle('open', open);
  panel.setAttribute('aria-hidden', String(!open));
  toggleBtn.textContent = open?'▾ Sakrij kontrole':'▴ Kontrole';
  toggleBtn.setAttribute('aria-expanded', open?'true':'false');
}
toggleBtn.addEventListener('click', ()=>togglePanel());

/* presets */
document.querySelectorAll('[data-preset]').forEach(b=>b.addEventListener('click',()=>{ inMin.value=parseInt(b.dataset.preset,10)||0; inSec.value=0; reset(); }));

/* primjena postavki */
$('btnApply').addEventListener('click', ()=>{
  if(inTitle.value.trim()) titleText.textContent=inTitle.value.trim();
  applyTheme(); reset(); loadAudio(); saveSettings();
});

/* kontrole */
$('btnStart').addEventListener('click', ()=>{ const mm=parseInt(m1.textContent+m2.textContent,10); const ss=parseInt(s1.textContent+s2.textContent,10); durationMs=(mm*60+ss)*1000; alerted5=alerted1=ended=false; start(); });
$('btnPause').addEventListener('click', pause);
$('btnReset').addEventListener('click', reset);
$('btnFS').addEventListener('click', ()=>{ if(!document.fullscreenElement) document.documentElement.requestFullscreen().catch(()=>{}); else document.exitFullscreen().catch(()=>{}) });
$('btnBlack').addEventListener('click', ()=> blackout.classList.toggle('show'));
btnTest5.addEventListener('click', ()=>{ loadAudio(); snd5&&snd5.play().catch(()=>{}) });
btnTest1.addEventListener('click', ()=>{ loadAudio(); snd1&&snd1.play().catch(()=>{}) });
btnTestEnd.addEventListener('click', ()=>{ loadAudio(); sndEnd&&sndEnd.play().catch(()=>{}) });

/* ====== tastatura / daljinski ====== */
function toggleRun(){ running?pause():start(); }
window.addEventListener('keydown', (e)=>{
  const k=e.key.toLowerCase();
  if([' ','enter','arrowright','pagedown'].includes(k) || e.code==='Space'){ e.preventDefault(); toggleRun(); return; }
  if(['arrowleft','pageup','r'].includes(k)){ e.preventDefault(); reset(); return; }
  if(k==='f'){ e.preventDefault(); $('btnFS').click(); return; }
  if(k==='h'){ e.preventDefault(); togglePanel(); return; }
  if(k==='b' || k==='.'){ e.preventDefault(); blackout.classList.toggle('show'); return; }
});

/* ====== auto-hide toggle u fullscreenu ====== */
let hideTimer=null;
function scheduleHide(){
  if(inAutoHide.value==='off'){ toggleBtn.classList.remove('hidden'); return; }
  if(!document.fullscreenElement){ toggleBtn.classList.remove('hidden'); return; }
  toggleBtn.classList.remove('hidden');
  clearTimeout(hideTimer);
  hideTimer=setTimeout(()=>toggleBtn.classList.add('hidden'), 2000);
}
document.addEventListener('mousemove', scheduleHide);
document.addEventListener('fullscreenchange', scheduleHide);

/* ====== persist ====== */
function saveSettings(){
  const data={t:titleText.textContent, top:inTop.value, m:inMin.value, s:inSec.value, theme:inTheme.value, size:inSize.value, stretch:inStretch.value, sep:inSep.value, bg:inBg.value, c1:inCol1.value, c2:inCol2.value, dc:inDigitColor.value, blink:inBlink.value, ah:inAutoHide.value, b5:inBeep5.value, b1:inBeep1.value, bend:inEnd.value, vol:inVol.value};
  localStorage.setItem('timerSettings', JSON.stringify(data));
}
function loadSettings(){
  const raw=localStorage.getItem('timerSettings'); if(!raw) return;
  try{
    const s=JSON.parse(raw);
    inTitle.value=s.t||''; titleText.textContent=s.t||titleText.textContent;
    inTop.value=s.top||'on'; inMin.value=s.m??10; inSec.value=s.s??0;
    inTheme.value=s.theme||'elegant'; inSize.value=s.size||0; inStretch.value=s.stretch||'1.22';
    inSep.value=s.sep||':'; inBg.value=s.bg||'#ffffff';
    inCol1.value=s.c1||'#ff8ec0'; inCol2.value=s.c2||'#ff5a9b'; inDigitColor.value=s.dc||'#111111';
    inBlink.value=s.blink||'on'; inAutoHide.value=s.ah||'on';
    inBeep5.value=s.b5||''; inBeep1.value=s.b1||''; inEnd.value=s.bend||''; inVol.value=s.vol||1;
  }catch{}
}

/* ====== init ====== */
function init(){
  panel.classList.remove('open'); panel.setAttribute('aria-hidden','true');
  toggleBtn.classList.add('hidden');      // start: sakriveno dugme
  loadSettings(); applyTheme(); paint(durationMs); loadAudio();
  // dugme se pojavi u fullscreen-u ili pri pomjeranju miša
  scheduleHide();
}
init();
</script>
</body>
</html>
